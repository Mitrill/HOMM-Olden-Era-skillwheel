<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>HoMM Olden Era Skill Wheel</title>
<style>
  :root{
    --bg:#0b0d13;
    --ring:#222632;
    --ring2:#1a1e29;
    --node-outline:#4be29a;
    --tooltip-bg:#11131a;
    --tooltip-border:#2c3140;
    --tooltip-text:#e6ebff;
    --sep-color:#4b5164;
    --sep-opacity:.65;

    --hud-bg: rgba(0,0,0,.35);
    --hud-bd: rgba(255,255,255,.14);
    --panel-bg: rgba(8,10,16,.72);
    --panel-bd: rgba(255,255,255,.12);
    --panel-shadow: 0 18px 60px rgba(0,0,0,.55);
  }
  html,body{ height:100%; margin:0; background:var(--bg); color:#e6ebff; font-family: Segoe UI, Roboto, Arial, sans-serif; }
  .board{
    position:relative;
    /* Bigger board so tooltips have room */
    width: clamp(720px, 99.5vmin, 2400px);
    aspect-ratio: 1 / 1;
    margin: 0 auto;
    background: radial-gradient(900px 900px at 50% 50%, #111525 0%, #0c0f19 70%, #0a0c14 100%);
    border-radius: 16px;
    box-shadow: inset 0 0 0 1px rgba(255,255,255,.05), 0 12px 38px rgba(0,0,0,.5);
    overflow:hidden;
    user-select:none;
  }
  .bg-watermark{
    position:absolute; inset:0;
    background-position: center; background-repeat: no-repeat; background-size: contain;
    opacity: .08; pointer-events: none; filter: saturate(.6) contrast(1.1);
  }
  svg{ display:block; width:100%; height:100%; }

  /* Decorative rings (underlay) – thinner */
  .ring{ fill:none; stroke:var(--ring); stroke-width:11; }
  .ring:nth-child(odd){ stroke: var(--ring2); }

  /* Separators (under icons) */
  .seps{ pointer-events:none; }
  .sep{
    stroke: var(--sep-color); stroke-opacity: var(--sep-opacity);
    stroke-width: 2.2; stroke-linecap: round;
  }

  /* Nodes */
  .node{ cursor:pointer; }
  .node .hit{ fill:transparent; stroke:none; pointer-events:all; }
  .node .badge{
    fill:none; stroke:transparent; stroke-width:3.2;
    filter: drop-shadow(0 0 6px rgba(122,255,194,.35));
    transition: stroke .12s ease, opacity .12s ease;
    pointer-events:none;
  }
  .node .icon{
    transition: filter .12s ease, transform .12s ease, opacity .12s ease;
    pointer-events:none;
  }
  .node:hover .icon{ transform: scale(1.06); }

  .node.selected .badge { stroke: var(--node-outline); }
  .node.selected .icon  { filter: saturate(1.1) drop-shadow(0 4px 10px rgba(0,0,0,.35)); opacity:1; }
  .node:not(.selected) .icon { filter: grayscale(0) contrast(1) brightness(1); opacity:.75; }

  /* Tooltip (smart positioning) */
  .tooltip{
    position:absolute; z-index:9999; pointer-events:none;
    min-width: 220px; max-width: min(340px, 80vw);
    background: var(--tooltip-bg); border:1px solid var(--tooltip-border);
    color:var(--tooltip-text); padding: .65rem .75rem; border-radius: 10px;
    box-shadow: 0 8px 28px rgba(0,0,0,.45);
    transform: translateX(-50%);
    opacity:0; transition: opacity .12s ease; font-size: .92rem;
  }
  .tooltip.show{ opacity:1; }
  .tooltip .t-name{ font-weight:600; margin-bottom:.25rem; color:#f5f8ff; }
  .tooltip .t-desc{ opacity:.92; line-height:1.25rem; }

  .tooltip::after{
    content:""; position:absolute; left:50%; transform: translateX(-50%);
    border:8px solid transparent;
  }
  .tooltip[data-pos="top"]::after{ bottom:-8px; border-top-color: var(--tooltip-border); }
  .tooltip[data-pos="below"]::after{ top:-8px; border-bottom-color: var(--tooltip-border); }

  /* HUD chips (top-left) */
  .level-badge, .race-badge{
    position:absolute; left:10px; z-index:25;
    display:inline-flex; gap:.45rem; align-items:center;
    padding:.35rem .6rem; border-radius:10px;
    background:var(--hud-bg); border:1px solid var(--hud-bd);
    color:#e6ebff; font: 600 .95rem/1 Segoe UI, Roboto, Arial, sans-serif;
    -webkit-backdrop-filter: blur(6px); backdrop-filter: blur(6px);
    user-select:none;
  }
  .level-badge{ top:10px; }
  .race-badge{ top:54px; } /* sits under Level chip */
  .level-badge .label{ opacity:.9; letter-spacing:.02em; }
  .level-badge .note{ margin-left:.25rem; font-weight:500; color:#ffb3b3; opacity:.95; }
  .level-badge.warn{ border-color:#ff6b6b; box-shadow:0 0 0 1px rgba(255,107,107,.25) inset; }

  .race-badge select{
    appearance: none;
    background: #1b1f2a; color:#e6ebff;
    border:1px solid rgba(255,255,255,.2);
    border-radius:8px; padding:.3rem .55rem;
    font: 600 .92rem/1 Segoe UI, Roboto, Arial, sans-serif;
    cursor:pointer;
  }

  /* Center race panels */
  .race-panels{
    position:absolute; inset:0;
    display:flex; justify-content:center; align-items:center;
    pointer-events:none; /* panels handle their own events */
  }
  .race-panels .wrap{
    width: min(50%, 800px);
    display:grid; grid-template-columns: 1fr 1fr; gap: 16px;
    pointer-events:none;
  }
  .race-panels .panel{
    background: var(--panel-bg);
    border:1px solid var(--panel-bd);
    border-radius: 14px;
    box-shadow: var(--panel-shadow);
    min-height: clamp(250px, 26vmin, 250px);
    padding: 14px 16px;
    overflow: auto;
    pointer-events:auto; /* allow text selection & scrolling */
  }
  .race-panels h3{
    margin: 0 0 6px; font-size: 0.95rem; font-weight:700; color:#f1f4ff;
  }
  .race-panels p, .race-panels li{
    color:#cfd6ea; font-size: 0.90rem; line-height: 1.05rem; margin: 0 0 .6rem;
  }
  .race-panels ul{ padding-left: 1.1rem; margin: .2rem 0 .8rem; }
  .race-panels em{ color:#a0abcc; }
  @media (max-width: 980px){
    .race-panels .wrap{ grid-template-columns: 1fr; }
  }
  .subclass-badge {
  position: absolute;
  right: 10px;
  top: 10px;
  z-index: 25;
  display: inline-flex;
  gap: .45rem;
  align-items: center;
  padding: .35rem .6rem;
  border-radius: 10px;
  background: var(--hud-bg);
  border: 1px solid var(--hud-bd);
  color: #e6ebff;
  font: 600 .95rem/1 Segoe UI, Roboto, Arial, sans-serif;
  -webkit-backdrop-filter: blur(6px);
  backdrop-filter: blur(6px);
  user-select: none;
}

.subclass-badge select {
  appearance: none;
  background: #1b1f2a;
  color: #e6ebff;
  border: 1px solid rgba(255,255,255,.2);
  border-radius: 8px;
  padding: .3rem .55rem;
  font: 600 .92rem/1 Segoe UI, Roboto, Arial, sans-serif;
  cursor: pointer;
}
.node.highlight-yellow .badge {
  stroke: #ffd84a !important;
  filter: drop-shadow(0 0 8px rgba(255,216,74,0.65));
}
</style>
</head>
<body>
  <div class="board" id="wheelHost">
    <!-- Optional background image; set BACKGROUND_IMAGE in JS -->
    <div class="bg-watermark" id="bgWatermark"></div>

    <!-- Level chip -->
    <div id="levelChip" class="level-badge" aria-live="polite" aria-atomic="true">
      <span class="label">Level</span>
      <span id="levelValue">0</span>
      <span id="levelNote" class="note"></span>
    </div>

    <!-- Race chip -->
    <div id="raceChip" class="race-badge" aria-live="polite" aria-atomic="true">
      <span class="label" style="opacity:.9; letter-spacing:.02em;">Faction</span>
      <select id="raceSelect">
        <option value="Temple">Temple</option>
        <option value="Schism">Schisme</option>
        <option value="Necropolis">Necropole</option>
        <option value="Dungeon">Donjon</option>
        <option value="Hive">Ruche</option>
        <option value="Sylvan">Sylve</option>
      </select>
    </div>
	<div id="subclassChip" class="subclass-badge" aria-live="polite" aria-atomic="true">
  <span class="label" style="opacity:.9; letter-spacing:.02em;">Sous-classe</span>
  <select id="subclassSelect">
    <option value="">— Sélectionner —</option>
  </select>
</div>

    <!-- Center panels for race text -->
    <div class="race-panels" id="racePanels">
      <div class="wrap">
        <section class="panel" id="racePanelLeft"></section>
        <section class="panel" id="racePanelRight"></section>
      </div>
    </div>

    <!-- Main SVG -->
    <svg viewBox="-600 -600 1200 1200" role="img" aria-label="Skill wheel">
      <defs id="defs"></defs>
      <g id="rings"></g>
      <g id="separators" class="seps"></g>
      <g id="nodes"></g>
      <g id="debug"></g>
    </svg>

    <!-- Tooltip -->
    <div class="tooltip" id="tooltip" aria-hidden="true" data-pos="top">
      <div class="t-name" id="ttName"></div>
      <div class="t-desc" id="ttDesc"></div>
    </div>
  </div>

<!-- =========================
     RACE CONTENT TEMPLATES
     Edit the HTML inside each <template> to change what appears
     ========================= -->
<template id="race-Temple">
  <div class="left">
    <h3>Might - sous-classe Bretteur</h3>
    <p>Coup héroïque inflige +200 points de dégât de base.</p>
	<p>Renseignements, Commandement, Chance, Sorts de Belladone, Offensive</p>
	 <h3>Might - sous-classe Parangon</h3>
	  <p>Tous les alliés infligent toujours le maximum de dégâts et subissent le minimum.</p>
	  <p>Art de la guerre, Sorts de Lumière, Diplomatie, Invocation d'Avatar, Stratégie</p>
  </div>
  <div class="right">
    <h3>Magic — sous-classe Grand Inquisiteur</h3>
    <p>Le héros ennemi ne peut utiliser chaque sort qu'une fois par combat.</p>
	<p>Sorts des Arcanes, Sorts primordiaux, Défense, Insight, Repérage </p>
	<h3>Magic — sous-classe Ascendant</h3>
    <p>Tous les sorts du héros coûtent toujours 0 mana.</p>
	<p>Économie, Logistique, Sorts Primordiaux, Résistance, Sorcellerie </p>
  </div>
</template>

<template id="race-Schism">
  <div class="left">
    <h3>Might - sous-classe Débridé"</h3>
    <p>Augmente le niveau de tous les dorts du héros à leur maximum.</p>
    <p>Sorts de Lumière, Commandement, Offensive, Repérage, Sorcellerie</p>
    <h3>Might - sous-classe Insensible</h3>
    <p>L'ennemi perd toutes les charges de focalisation au début de chaque tour de combat.</p>
    <p>Diplomatie, Économie, Renseignements, Sorts de Belladone, Résistance</p>
  </div>
  <div class="right">
    <h3>Magic — sous-classe Imparable</h3>
    <p>+10 en attaque, défense, puissance de sorts et savoir.</p>
    <p>Sorts primordiaux, Art de la guerre, Insight, Sorts Primordiaux, Stratégie</p>
    <h3>Magic — sous-classe Insondable</h3>
    <p>Tous les ennemis infligent toujours le minimum de dégâts et subissent le maximum de dégâts.</p>
    <p>Sorts des Arcanes, Défense, Logistique, Chance, Invocation d'Avatar</p>
  </div>
</template>

<template id="race-Necropolis">
  <div class="left">
    <h3>Might - sous-classe Héraut du destin</h3>
    <p>Les créatures ennemies en combat ont le minimum de chance possible et réussissent toujours à porter un coup malchanceux lorsqu'elles attaquent.</p>
    <p>Défense, Chance, Sorts Primordiaux, Repérage, Sorcellerie</p>
    <h3>Might - sous-classe Pourriture ambulante</h3>
    <p>Tous les ennemis ont toujours un moral minimum.</p>
    <p>Diplomatie, Renseignements, Sorts de Belladone, Résistance, Stratégie</p>
  </div>
  <div class="right">
    <h3>Magic — sous-classe Tisse-âme</h3>
    <p>Quand un peloton ennemi est tué au combat, un peloton temporaire d'esprits alliés apparaît à sa place.</p>
    <p>Sorts des Arcanes, Art de la guerre, Insight, Logistique, Invocation d'Avatar</p>
    <h3>Magic — sous-classe Chronomancien</h3>
    <p>La nécromancie fonctionne pour toutes les créatures et pas seulement les morts-vivants.</p>
    <p>Sorts primordiaux, Sorts de Lumière, Économie, Offensive, Stratégie</p>
  </div>
</template>

<template id="race-Dungeon">
  <div class="left">
    <h3>Might - sous-classe Garde du corps de Balthalzar</h3>
    <p>Augmente l'attaque de 100%.</p>
    <p>Diplomatie, Renseignements, Commandement, Sorts de Belladone, Offensive</p>
    <h3>Might - sous-classe Envoyé de Silvertongue</h3>
    <p>Augmente la défense de 100%.</p>
    <p>Sorts de Lumière, Défense, Chance, Repérage, Sorcellerie</p>
  </div>
  <div class="right">
    <h3>Magic — sous-classe Héritier d'Amelchia</h3>
    <p>Augmente la puissance des sorts de 100 %.</p>
    <p>Art de la guerre, Invocation d'Avatar, Stratégie, Insight, Sorts Primordiaux</p>
    <h3>Magic — sous-classe Grand Marchand</h3>
    <p>Octroie + 10 000 d'or par jour.</p>
    <p>Sorts des Arcanes, Sorts primordiaux, Économie, Logistique, Résistance</p>
  </div>
</template>

<template id="race-Hive">
  <div class="left">
    <h3>Hive — Brood</h3>
    <p>Left panel for <em>Hive</em>.</p>
  </div>
  <div class="right">
    <h3>Hive — Swarm Stratégie</h3>
    <p>Right panel for <em>Hive</em>.</p>
  </div>
</template>

<template id="race-Sylvan">
  <div class="left">
    <h3>Sylvan — Harmony</h3>
    <p>Left panel for <em>Sylvan</em>.</p>
  </div>
  <div class="right">
    <h3>Sylvan — Warfare</h3>
    <p>Right panel for <em>Sylvan</em>.</p>
  </div>
</template>

<script>
/* =========================
   Skill wheel configuration (unchanged core)
   ========================= */

/** Optional background watermark image (set "" to disable) */
const BACKGROUND_IMAGE = ""; // e.g., "this.jpg"

/** Placeholder image for icons you haven’t set yet */
const ICON_PLACEHOLDER = "data:image/svg+xml;utf8,\
<svg xmlns='http://www.w3.org/2000/svg' width='200' height='200'>\
<defs><linearGradient id='g' x1='0' y1='0' x2='1' y2='1'><stop offset='0%' stop-color='%230c1224'/><stop offset='100%' stop-color='%231b2240'/></linearGradient></defs>\
<rect width='100%' height='100%' fill='url(%23g)'/>\
<circle cx='100' cy='100' r='82' fill='none' stroke='%234b5164' stroke-width='6'/>\
<text x='100' y='110' text-anchor='middle' font-size='28' fill='%23cdd4ea' font-family='Segoe UI, Arial'>IMG</text></svg>";

/** Geometry & spacing (your current layout) */
const SECTORS    = 23;
const startAngle = 90;
const clockwise  = true;

const GROUP_GAP_DEG   = 1;
const INTRA_GAP_DEG   = 0.1;
const RADIAL_GAP_MIN  = 6;
const PAD_VISUAL      = 4.0;

/** Rings (outer → inner) */
const RINGS = [
  { name:"Outer",  radius: 565, sizeMax: 40 },
  { name:"Middle", radius: 500, sizeMax: 44 },
  { name:"Inner",  radius: 440, sizeMax: 46 }
];

/** Decorative rings (underlay) */
const DECORATIVE_RINGS = [ { r: 410 }, { r: 470 }, { r: 535 }, { r: 595 } ];
const RING_STROKE = 11;

/** Separators */
const SEPARATORS = { show:true, strokeWidth:2.2, outerExtend:0, innerInset:0, dashed:false };



/** ICONS_CONFIG (edit these paths/texts) */
const ICONS_CONFIG = {
  outer: {
    "01":[
      {icon:"Icons/bl11.jpg",name:"Chance de base",desc:"La chance augmente de 1"},
      {icon:"Icons/al11.jpg",name:"Chance avancée",desc:"La chance augmente de 2"},
      {icon:"Icons/el11.jpg",name:"Chance d'expert",desc:"La chance augmente de 3"}
    ],
    "02":[
      {icon:"Icons/bo1.jpg",name:"Offensive de base",desc:"Les attaques de base des créatures alliées infligent +10% de dégâts."},
      {icon:"Icons/ao1.jpg",name:"Offensive avancée",desc:"Les attaques de base des créatures alliées infligent +15% de dégâts."},
      {icon:"Icons/eo1.jpg",name:"Offensive d'expert",desc:"Les attaques de base des créatures alliées infligent +20% de dégâts."}
    ],
    "03":[
      {icon:"Icons/bd11.jpg",name:"Défense de base",desc:"Les créatures alliées subissent -10% de dégâts des attaques de base."},
      {icon:"Icons/ad11.jpg",name:"Défense avancée",desc:"Les créatures alliées subissent -15% de dégâts des attaques de base."},
      {icon:"Icons/ed11.jpg",name:"Défense d'expert",desc:"Les créatures alliées subissent -20% de dégâts des attaques de base."}
    ],
    "04":[
      {icon:"Icons/bb1.jpg",name:"Art de la Guerre de base",desc:"Lorsqu'une créature attend au combat, elle gagne +20% en attaque jusqu'à la fin du tour. Lorsqu'elle passe son tour, elle gagne +20% de défense jusqu'à la fin du tour."},
      {icon:"Icons/ab1.jpg",name:"Art de la Guerre avancée",desc:"Lorsqu'une créature attend au combat, elle gagne +30% en attaque jusqu'à la fin du tour. Lorsqu'elle passe son tour, elle gagne +30% de défense jusqu'à la fin du tour."},
      {icon:"Icons/eb1.jpg",name:"Art de la Guerre d'expert",desc:"Lorsqu'une créature attend au combat, elle gagne +40% en attaque jusqu'à la fin du tour. Lorsqu'elle passe son tour, elle gagne +40% de défense jusqu'à la fin du tour."}
    ],
    "05":[
      {icon:"Icons/br11.jpg",name:"Recrutement de base",desc:"Augmente de 4 la formation des créatures de rang 1 dans tous les villes."},
      {icon:"Icons/ar1.jpg",name:"Recrutement avancé",desc:"Augmente de 4 la formation des créatures de rang 1 et +2 à la formation des créatures de rang 2 dans tous les villes."},
      {icon:"Icons/er1.jpg",name:"Recrutement d'expert",desc:"Augmente de 4 la formation des créatures de rang 1, +2 à la formation des créatures de rang 2 et  +1 à la formation des créatures de rang 3 dans tous les villes."}
    ],
    "06":[
      {icon:"Icons/bt11.jpg",name:"Stratégie de base",desc:"Vous pouvez replacer les créatures avant le début du combat dans une zone de 2 lignes."},
      {icon:"Icons/at11.jpg",name:"Stratégie avancée",desc:"Vous pouvez replacer les créatures avant le début du combat dans une zone de 3 lignes."},
      {icon:"Icons/et11.jpg",name:"Stratégie d'expert",desc:"Vous pouvez replacer les créatures avant le début du combat dans une zone de 4 lignes."}
    ],
    "07":[
      {icon:"Icons/bl1.jpg",name:"Commandement de base",desc:"Le moral augmente de 1."},
      {icon:"Icons/al1.jpg",name:"Commandement avancé",desc:"Le moral augmente de 2."},
      {icon:"Icons/el1.jpg",name:"Commandement d'expert",desc:"Le moral augmente de 3."}
    ],
    "08":[
      {icon:"Icons/bs111.jpg",name:"Art du siège de base",desc:"Augmente de 50 points les dégâts de la catapulte."},
      {icon:"Icons/as111.jpg",name:"Art du siège avancé",desc:"Augmente de 100 points les dégâts de la catapulte."},
      {icon:"Icons/es111.jpg",name:"Art du siège d'expert",desc:"Augmente de 150 points les dégâts de la catapulte."}
    ],
    "09":[
      {icon:"Icons/br1.jpg",name:"Résistance de base",desc:"Les créatures subissent -10% de dégâts magiques."},
      {icon:"Icons/ar11.jpg",name:"Résistance avancée",desc:"Les créatures subissent -20% de dégâts magiques."},
      {icon:"Icons/er11.jpg",name:"Résistance d'expert",desc:"Les créatures subissent -30% de dégâts magiques."}
    ],
    "10":[
      {icon:"Icons/bdm1.jpg",name:"Sorts de Lumière de base",desc:"Le héros peut apprendre des sorts de lumière de rang 3. Ces sorts gagnent +1 niveau."},
      {icon:"Icons/adm1.jpg",name:"Sorts de Lumière avancés",desc:"Le héros peut apprendre des sorts de lumière de rang 4. Ces sorts coûtent -3 de mana et gagnent +1 niveau."},
      {icon:"Icons/edm1.jpg",name:"Sorts de Lumière d'd'expert",desc:"Le héros peut apprendre des sorts de lumière de rang 5 sans se rendre dans une guilde de mage. Ces sorts coûtent -3 de mana et gagnent +1 niveau."}
    ],
    "11":[
      {icon:"Icons/bn1.jpg",name:"Sorts de Belladone de base",desc:"Le héros peut apprendre des sorts de belladone de rang 3. Ces sorts gagnent +1 niveau."},
      {icon:"Icons/anm1.jpg",name:"Sorts de Belladone avancée",desc:"Le héros peut apprendre des sorts de belladone de rang 4. Ces sorts coûtent -3 de mana et gagnent +1 niveau."},
      {icon:"Icons/enm1.jpg",name:"Sorts de Belladone d'expert",desc:"Le héros peut apprendre des sorts de belladone de rang 5 sans visiter de guilde. Ces sorts coûtent -3 de mana et gagnent +1 niveau."}
    ],
    "12":[
      {icon:"Icons/bi11.jpg",name:"Renseignements de base",desc:"Le héros peut apprendre des sorts jusqu'au rang 3 sans avoir besoin d'apprendre l'école de magie correspondante."},
      {icon:"Icons/ai11.jpg",name:"Renseignements avancés",desc:"Le héros peut apprendre des sorts jusqu'au rang 4 sans avoir besoin d'apprendre l'école de magie correspondante."},
      {icon:"Icons/ei11.jpg",name:"Renseignements d'expert",desc:"Le héros peut apprendre des sorts jusqu'au rang 5 sans avoir besoin d'apprendre l'école de magie correspondante."}
    ],
    "13":[
      {icon:"Icons/as1.jpg",name:"Sorts des Arcanes de base",desc:"Le héros peut apprendre des sorts des arcanes de rang 3. Ces sorts gagnent +1 niveau."},
      {icon:"Icons/aam1.jpg",name:"Sorts des Arcanes avancée",desc:"Le héros peut apprendre des sorts des arcanes de rang 4. Ces sorts coûtent -3 de mana et gagnent +1 niveau."},
      {icon:"Icons/eam1.jpg",name:"Sorts des Arcanes d'expert",desc:"Le héros peut apprendre des sorts des arcanes de rang 5 sans visiter de guilde. Ces sorts coûtent -3 de mana et gagnent +1 niveau."}
    ],
    "14":[
      {icon:"Icons/bbm1.jpg",name:"Sorts Martiaux de base",desc:"L'attaque et la défense des créatures alliées augmentent de 10% de la puissance de sort et du savoir de leur héros."},
      {icon:"Icons/abm1.jpg",name:"Sorts Martiaux avancée",desc:"L'attaque et la défense des créatures alliées augmentent de 20% de la puissance de sort et du savoir de leur héros."},
      {icon:"Icons/ebm1.jpg",name:"Sorts Martiaux d'expert",desc:"L'attaque et la défense des créatures alliées augmentent de 30% de la puissance de sort et du savoir de leur héros."}
    ],
    "15":[
      {icon:"Icons/bpm1.jpg",name:"Sorts Primordiaux de base",desc:"Le héros peut apprendre des sorts primordiaux de rang 3. Ces sorts gagnent +1 niveau."},
      {icon:"Icons/apm1.jpg",name:"Sorts Primordiaux avancés",desc:"Le héros peut apprendre des sorts primordiaux de rang 4. Ces sorts coûtent -3 de mana et gagnent +1 niveau."},
      {icon:"Icons/epm1.jpg",name:"Sorts Primordiaux d'd'expert",desc:"Le héros peut apprendre des sorts primordiaux de rang 5 sans visiter de guilde. Ces sorts coûtent -3 de mana et gagnent +1 niveau."}
    ],
    "16":[
      {icon:"Icons/bs1.jpg",name:"Sorcellerie de base",desc:"+10% de dégâts magiques."},
      {icon:"Icons/as1111.jpg",name:"Sorcellerie avancée",desc:"+20% de dégâts magiques."},
      {icon:"Icons/es3.jpg",name:"Sorcellerie d'expert",desc:"+30% de dégâts magiques."}
    ],
    "17":[
      {icon:"Icons/bsa1.jpg",name:"Invocation d'Avatar de base",desc:"Accorde un sort de combat unique. Il invoque un avatar qui évolue fortement grâce au niveau de la puissance de sorts et du savoir du héros."},
      {icon:"Icons/asa1.jpg",name:"Invocation d'Avatar avancée",desc:"Accorde un sort de combat unique. Il invoque un avatar qui évolue fortement grâce au niveau de la puissance de sorts et du savoir du héros."},
      {icon:"Icons/esa1.jpg",name:"Invocation d'Avatar d'expert",desc:"Accorde un sort de combat unique. Il invoque un avatar qui évolue fortement grâce au niveau de la puissance de sorts et du savoir du héros."}
    ],
    "18":[
      {icon:"Icons/bt1.jpg",name:"Thaumaturgie de base",desc:"Permet au héros d'utiliser le grimoire une fois de plus par tour de combat. Les sorts coûtent 300% de mana en plus après chaque utilisation."},
      {icon:"Icons/at1.jpg",name:"Thaumaturgie avancée",desc:"Permet au héros d'utiliser le grimoire une fois de plus par tour de combat. Les sorts coûtent 200% de mana en plus après chaque utilisation."},
      {icon:"Icons/et1.jpg",name:"Thaumaturgie d'expert",desc:"Permet au héros d'utiliser le grimoire une fois de plus par tour de combat. Les sorts coûtent 100% de mana en plus après chaque utilisation."}
    ],
    "19":[
      {icon:"Icons/bd1.jpg",name:"Diplomatie de base",desc:"Vous permet parfois de recruter des armées neutres contre de l'or au lieu de les combattre."},
      {icon:"Icons/ad1.jpg",name:"Diplomatie avancée",desc:"Vous permet parfois de recruter des armées neutres contre de l'or au lieu de les combattre. +25 % en puissance de persuasion en diplomatie."},
      {icon:"Icons/ed1.jpg",name:"Diplomatie d'expert",desc:"Vous permet parfois de recruter des armées neutres contre de l'or au lieu de les combattre. +50 % en puissance de persuasion en diplomatie."}
    ],
    "20":[
      {icon:"Icons/bl111.jpg",name:"Logistique de base",desc:"+10% de points de mouvement sur la carte globale."},
      {icon:"Icons/alg2.jpg",name:"Logistique avancée",desc:"+15% de points de mouvement sur la carte globale."},
      {icon:"Icons/elg1.jpg",name:"Logistique d'expert",desc:"+20% de points de mouvement sur la carte globale."}
    ],
    "21":[
      {icon:"Icons/bi1.jpg",name:"Perspicacité de base",desc:"+20% d'XP."},
      {icon:"Icons/ai1.jpg",name:"Perspicacité avancée",desc:"+30% d'XP."},
      {icon:"Icons/ei1.jpg",name:"Perspicacité d'expert",desc:"+40% d'XP."}
    ],
    "22":[
      {icon:"Icons/be1.jpg",name:"Économie de base",desc:"Augmente de 500 les pièces d'or par jour."},
      {icon:"Icons/ae1.jpg",name:"Économie avancée",desc:"Augmente de 1000 les pièces d'or par jour."},
      {icon:"Icons/ee1.jpg",name:"Économie d'expert",desc:"Augmente de 1500 les pièces d'or par jour."}
    ],
    "23":[
      {icon:"Icons/bs11.jpg",name:"Repérage de base",desc:"Augmente de 1 le champ de vision."},
      {icon:"Icons/as11.jpg",name:"Repérage avancé",desc:"Augmente de 2 le champ de vision."},
      {icon:"Icons/es1.jpg",name:"Repérage d'expert",desc:"Augmente de 3 le champ de vision."}
    ]
  },
  middle: {
    "01":[
      {icon:"Icons/bc1.jpg",name:"Confiance bestiale",desc:"Les créatures alliées ont 1% de chances supplémentaires de réussir un coup de chance par point de chance (bonus x2 si le héros connaît :  Sorts primordiaux."},
      {icon:"Icons/ah.jpg",name:"Toujours pile",desc:"Vous gagnez 25% d'or et de ressources en plus grâce aux piles sur la carte globale (bonus x2 si le héros connaît : Économie)."},
      {icon:"Icons/mc.jpg",name:"L'Élu de Mearea",desc:"La chance de l'ennemi est réduite de 1 au combat."}
    ],
    "02":[
      {icon:"Icons/ba.jpg",name:"Arts de Combat",desc:"Les compétences des unités alliées infligent +50% de dégâts."},
      {icon:"Icons/a1.jpg",name:"Tir à l'Arc",desc:"Les attaques à distance et à longue portée des unités alliées infligent +15% de dégâts."},
      {icon:"Icons/bm.jpg",name:"Marche de Bataille",desc:"Les unités alliées génèrent +1 point de concentration lorsqu'elles attaquent."}
    ],
    "03":[
      {icon:"Icons/sas.jpg",name:"Boucliers et coquilles",desc:"Les créatures alliées subissent -25% de dégâts de contre-attaques."},
      {icon:"Icons/c.jpg",name:"Couverture",desc:"Les créatures alliées subissent -20% de dégâts d'attaques à distance et à longue portée."},
      {icon:"Icons/htm.jpg",name:"Hymne aux Martyrs",desc:"Les créatures alliées génèrent +1 point de focalisation lorsqu'elles subissent des dégâts."}
    ],
    "04":[
      {icon:"Icons/mm.jpg",name:"Maîtrise du corps à corps",desc:"Augmente de 10% les dégâts infligés par les créatures alliées, et réduit de 10% les dégâts au corps à corps qu'elles subissent."},
      {icon:"Icons/rm.jpg",name:"Maîtrise à distance",desc:"Augmente de 10% les dégâts infligés par les créatures alliées, et réduit de 10% les dégâts à distance et de longue portée qu'elles subissent."},
      {icon:"Icons/overwatch.jpg",name:"Vigilance",desc:"Les créatures alliées passent en « Vigilance » lorsqu'elles choisissent d'attendre en combat. « Vigilance » leur permet de lancer une contre-attaque sur tout ennemi se déplaçant à portée de corps à corps."}
    ],
    "05":[
      {icon:"Icons/ds.jpg",name:"Surveillance directe",desc:"Si le héros est dans une ville au début d'une semaine, la formation de toutes les créatures de cette ville augmente de 50%."},
      {icon:"Icons/eg.jpg",name:"Gardes d'élite",desc:"L'attaque et la défense des créatures alliées de rang 1, 2 et 3 augmentent de 25% de l'attaque et de la défense de leur héros."},
      {icon:"Icons/vet.jpg",name:"Vétérans",desc:"La formation des créatures de rang 4 dans vos villes augmente de 1."}
    ],
    "06":[
      {icon:"Icons/ofa.jpg",name:"Un pour tous",desc:"Les créatures alliées gagnent +3 en attaque pour chaque ennemi proche (bonus x2 si le héros connaît : Offensive."},
      {icon:"Icons/ep.jpg",name:"Proie facile",desc:"Chaque fois qu'un ennemi attend, augmente de 2 l'initiative des créatures alliées jusqu'à la fin du tour (ne se cumule pas)."},
      {icon:"Icons/em.jpg",name:"Mana énergisant",desc:"+1 charge de focalisation chaque fois que votre ennemi utilise un sort."}
    ],
    "07":[
      {icon:"Icons/r1.jpg",name:"Détermination",desc:"Les créatures alliées ont 1% de chances supplémentaires de jouer une fois de plus pour chaque point de moral (bonus x2 si le héros connaît : Art de la Guerre)."},
      {icon:"Icons/hol.jpg",name:"Héros légendaire",desc:"Réduit le moral de l'ennemi de 1 en combat."},
      {icon:"Icons/uad.jpg",name:"Des hauts et des bas",desc:"Chaque fois qu'une créature alliée déclenche un effet de moral négatif, son moral augmente de 5 jusqu'à la fin du tour suivant."}
    ],
    "08":[
      {icon:"Icons/ra.jpg",name:"Assaut implacable",desc:"Augmente de 1 la vitesse et l'initiative des créatures alliées pendant un siège."},
      {icon:"Icons/fo.jpg",name:"Éclaireurs avancés",desc:"Les dégâts à distance des créatures alliées ne sont pas réduits par les murs pendant un siège."},
      {icon:"Icons/b.jpg",name:"Barrage",desc:"Accorde une capacité de siège unique : une fois par tour, permet d'attaquer une case et toutes ses cases adjacentes."}
    ],
    "09":[
      {icon:"Icons/obs.jpg",name:"Obstruction",desc:"Les sorts ennemis coûtent 20% de mana en plus. Si vous avez débloqué une école de magie, le coût des sorts ennemis de cette école augmente de 20% supplémentaires."},
      {icon:"Icons/res.jpg",name:"Résilience",desc:"Les créatures subissent -10% de dégâts magiques."},
      {icon:"Icons/fm.jpg",name:"Métabolisme rapide",desc:"Tous les effets négatifs sur les créatures alliées durent 2 tours de moins (pas moins de 2)."}
    ],
    "10":[
      {icon:"Icons/ssa.jpg",name:"Synergie des érudits : Arina",desc:"+4 en puissance de sorts lors du lancement de sorts de lumière (+1 pour chaque école de magie différente apprise)."},
      {icon:"Icons/lf.jpg",name:"Focalisation lumineuse",desc:"+1 charge de focalisation au début du combat."},
      {icon:"Icons/bs.jpg",name:"Le soleil le plus brillant",desc:"-1 niveau à tous les sorts de lumière ennemis."}
    ],
    "11":[
      {icon:"Icons/ss.jpg",name:"Synergie des érudits : Naira",desc:"+4 en puissance de sorts lors du lancement de sorts de belladone (+1 pour chaque école de magie différente apprise)."},
      {icon:"Icons/d.jpg",name:"Dissimulation",desc:"Les ennemis ne peuvent pas voir les informations détaillées sur votre armée : ils voient un nombre aléatoire de créatures aléatoires."},
      {icon:"Icons/dn.jpg",name:"La nuit la plus sombre",desc:"-1 niveau à tous les sorts de belladone ennemis."}
    ],
    "12":[
      {icon:"Icons/g.jpg",name:"Génie",desc:"Le héros monte immédiatement de niveau une seconde fois."},
      {icon:"Icons/ast.jpg",name:"Astrologie",desc:"Le héros commence l'apprentissage de la magie neutre à des niveaux inférieurs."},
      {icon:"Icons/ee11.jpg",name:"Œil de lynx",desc:"Au début du combat, enseigne tous les sorts que l'ennemi connaît et que le héros est capable d'apprendre."}
    ],
    "13":[
      {icon:"Icons/ssd.jpg",name:"Synergie des érudits : Doreath",desc:"+4 en puissance de sorts lors du lancement de sorts des arcanes (+1 pour chaque école de magie différente apprise."},
      {icon:"Icons/alie.jpg",name:"Toute vie est infinie",desc:"+30% de soins et de réanimation grâce aux capacités des créatures alliées et aux sorts des héros au combat (bonus x2 si le héros connaît : Invocation d'Avatar."},
      {icon:"Icons/pt.jpg",name:"Pensée la plus pure",desc:"-1 niveau à tous les sorts des arcanes ennemis."}
    ],
    "14":[
      {icon:"Icons/aod.jpg",name:"Aura de destruction",desc:"Chaque fois que le héros utilise un sort en combat, son attaque augmente de 2 jusqu'à la fin du combat."},
      {icon:"Icons/aop.jpg",name:"Aura de protection",desc:"Chaque fois que le héros utilise un sort en combat, sa défense augmente de 2 jusqu'à la fin du combat."},
      {icon:"Icons/aow.jpg",name:"Aura de sorcellerie",desc:"Chaque fois que le héros utilise un sort en combat, la puissance de sorts augmente de 2 jusqu'à la fin du combat."}
    ],
    "15":[
      {icon:"Icons/ssh.jpg",name:"Synergie des érudits : Hksmilla",desc:"+4 en puissance des sorts lors du lancement de sorts primordiaux (+1 pour chaque école de magie différente apprise)."},
      {icon:"Icons/pf.jpg",name:"Force primordiale",desc:"Les effets négatifs et positifs utilisés par le héros et les créatures alliées durent 1 tour supplémentaire."},
      {icon:"Icons/st.jpg",name:"Dents acérées",desc:"-1 niveau à tous les sorts primordiaux ennemis."}
    ],
    "16":[
      {icon:"Icons/sm.jpg",name:"Sorts collants",desc:"Les sorts durent 1 tour supplémentaire (bonus x2 si le héros connaît : Renseignements)."},
      {icon:"Icons/ma.jpg",name:"Flèche magique",desc:"Accorde un nouveau sort de combat. Il inflige des dégâts magiques à une cible et ne coûte pas de mana."},
      {icon:"Icons/re.jpg",name:"Énergie brute",desc:"+10% de dégâts magiques (bonus x2 si le héros connaît : Offensive)."}
    ],
    "17":[
      {icon:"Icons/aof.jpg",name:"Avatar de la fureur",desc:"L'attaque de l'avatar augmente de 25% de la puissance de sort de son héros (bonus x2 si le héros connaît : Commandement."},
      {icon:"Icons/aot.jpg",name:"Avatar de la ténacité",desc:"La défense de l'avatar augmente de 25% du savoir de son héros (bonus x2 si le héros connaît : Défense."},
      {icon:"Icons/aoc.jpg",name:"Avatar de la célérité",desc:"La vitesse et l'initiative de l'avatar augmentent de 2 (bonus x2 si le héros connaît : Perspicacité."}
    ],
    "18":[
      {icon:"Icons/a.jpg",name:"Antimage",desc:"Les sorts ennemis coûtent 4 de mana en plus."},
      {icon:"Icons/vs.jpg",name:"Vaste âme",desc:"Augmente de 10% le mana restauré quotidiennement."},
      {icon:"Icons/hm.jpg",name:"Archimage",desc:"Tous vos sorts d'écoles de magie gagnent 1 niveau."}
    ],
    "19":[
      {icon:"Icons/ltl.jpg",name:"Plus grand que nature",desc:"Augmente de 25% la puissance de votre armée aux yeux des créatures neutres ; ce qui les rend plus susceptibles de vous rejoindre ou fuir (bonus x2 si le héros connaît : Art de la guerre."},
      {icon:"Icons/e.jpg",name:"Éloquence",desc:"Réduit de 75% au coût d'une capitulation."},
      {icon:"Icons/fh.jpg",name:"Héros du peuple",desc:"+50 % de puissance de persuasion en diplomatie avec les pelotons sur la carte globale de la faction du héros."}
    ],
    "20":[
      {icon:"Icons/sp1.jpg",name:"Passages secrets",desc:"La pénalité de terrain est réduite de 50%."},
      {icon:"Icons/sm1.jpg",name:"Montures fortes",desc:"Les sorts neutres de la carte globale coûtent -4 de mana (bonus x2 si le héros connaît : Repérage)."},
      {icon:"Icons/cp1.jpg",name:"Planification minutieuse",desc:"Chaque jour, le héros économise 50 points de mouvement inutilisés pour le jour suivant (bonus x2 si le héros connaît : Sorts des arcanes."}
    ],
    "21":[
      {icon:"Icons/enl.jpg",name:"Illumination",desc:"+10% d'XP."},
      {icon:"Icons/ci.jpg",name:"Innovation civique",desc:"Le héros gagne +100% de points de loi (bonus x2 si le héros connaît : Commandement."},
      {icon:"Icons/sag.jpg",name:"Sagacité",desc:"Affiche les intentions de tous les pelotons neutres situées ) [300% x champ de vision du héros] case(s) du héros sur la carte globale."}
    ],
    "22":[
      {icon:"Icons/tc.jpg",name:"Percepteur d'impôts",desc:"+500 d'or par jour (bonus x2 si le héros connaît : Logistique."},
      {icon:"Icons/s.jpg",name:"Contrebandier",desc:"+1 cristaux, gemmes ou mercure par jour (selon la faction du héros)."},
      {icon:"Icons/mb.jpg",name:"Maître-bâtisseur",desc:"+1 de bois et de minerai par jour."}
    ],
    "23":[
      {icon:"Icons/ls.jpg",name:"Vision Longue",desc:"Rayon de vision augmenté de 1. Bonus doublé si le héros connaît la chance."},
      {icon:"Icons/fp.jpg",name:"Chemins Familier",desc:"+15% points de mouvement si le héros commence la journée dans une zone qu'il contrôle. Bonus doublé si le héros connaît l'Renseignements."},
      {icon:"Icons/path.jpg",name:"Orientation",desc:"-50% de pénalité de terrain."}
    ]
	},
  inner: {
    "01":[
      {icon:"Icons/lh.jpg",name:"Coup de chance",desc:"Chaque fois que des créatures alliées réussisent un coup de chance, les ennemis ne contre-attaquent pas."},
      {icon:"Icons/lst.jpg",name:"La foudre frappe deux fois",desc:"Les sorts peuvent également réussir un coup de chance et infliger 150% de dégâts, avec 5% de chances supplémentaires pour chaque point de chance."},
    ],
    "02":[
      {icon:"Icons/sb.jpg",name:"Lames d'ombre",desc:"Les créatures alliées infligent +1 dégât (bonus x2 si le héros connaît : Sorts de belladone)."},
      {icon:"Icons/uf.jpg",name:"Force imparable",desc:"Les créatures ignorent 10% de la défense de la cible lorsqu'elles infligent des dégâts normaux, y compris des capacités."}
    ],
    "03":[
      {icon:"Icons/ta.jpg",name:"Avantage territorial",desc:"Quand le héros combat dans une zone qu'il contrôle, chaque peloton de l'armée du héros gagne 10% d'unités temporaires au début du combat (bonus x2 si le héros connaît : Diplomatie."},
      {icon:"Icons/f.jpg",name:"Fermeté",desc:"Les créatures alliées ignorent 10% de l'attaque de l'attaquant lorsqu'elles subissent des dégâts normaux, y compris des capacités."}
    ],
    "04":[
      {icon:"Icons/bf.jpg",name:"Concentration de combat",desc:"Génère 1 charge de focalisation au début de chaque tour de combat."},
      {icon:"Icons/ps.jpg",name:"Frappe préventive",desc:"Les créatures alliées se préparent à lancer une frappe préventive lorsqu'elles passent leur tour. Cela leur permet de lancer une contre-attaque avant l'assaut ennemi."}
    ],
    "05":[
      {icon:"Icons/relo.jpg",name:"Transfert",desc:"Accorde un nouveau sort de carte globale : permet d'interagir une fois pas jour avec n'importe quelle ville contrôlée, permettant le transfert de créatures vers ou depuis cette ville."},
      {icon:"Icons/str.jpg",name:"Entraînement intense",desc:"Augmente de 2 les PV des créatures alliées."}
    ],
    "06":[
      {icon:"Icons/afo.jpg",name:"Tous pour un",desc:"Les créatures alliées reçoivent +3 en défense pour chaque allié proche (bonus x2 si le héros connaît : Défense."},
      {icon:"Icons/rm1.jpg",name:"Maîtrise de la riposte",desc:"Chaque fois qu'une créature alliée élimine un ennemi avec une contre-attaque, ses contre-attaques se rechargent."}
    ],
    "07":[
      {icon:"Icons/wsns.jpg",name:"Où le soleil ne se couche jamais",desc:"Augmente l'attaque, la défense et la puissance de sorts de 3 et le champ de vision de 3 dans une zone que vous ne contrôlez pas (bonus x2 si le héros connaît : Sorts de lumière."},
      {icon:"Icons/m.jpg",name:"En avant !",desc:"L'initiative des créatures alliées augmente de 1."}
    ],
    "08":[
      {icon:"Icons/pha.jpg",name:"Bataillon",desc:"Réduit de 50% les dégâts des tours du défenseur sur les créatures alliées pendant un siège."},
      {icon:"Icons/tun.jpg",name:"Percée souterraine",desc:"Accorde une capacité de siège unique : permet de téléporter une créature alliée ciblée sur un maximum de 3 cases, une fois par tour."}
    ],
    "09":[
      {icon:"Icons/ha.jpg",name:"Aura d'entrave",desc:"Pendant le combat, l'ennemi perd 1 charge de focalisation au début de chaque tour."},
      {icon:"Icons/ms.jpg",name:"Suppression magique",desc:"Accorde une nouvelle capacité : élimine la créature invoquée ciblée ou toutes les unités temporaires d'un peloton en particulier."}
    ],
    "10":[
      {icon:"Icons/dt.jpg",name:"Enseignements de la lumière",desc:"+1 niveau à tous les sorts de lumière."},
      {icon:"Icons/sol.jpg",name:"Vitesse de la lumière",desc:"+10 points de mouvement (bonus x2 si le héros connaît : Logistique."}
    ],
    "11":[
      {icon:"Icons/nt.jpg",name:"Enseignements sur la belladone",desc:"+1 niveau à tous les sorts de belladone."},
      {icon:"Icons/hotw.jpg",name:"L'heure du loup",desc:"-15% en attaque et en défense des créatures ennemies (bonus x2 si le héros connaît : Résistance."}
    ],
    "12":[
      {icon:"Icons/rc.jpg",name:"Cadence rythmique",desc:"Augmente la limite de mana de 25% (bonus x2 si le héros connaît : Sorcellerie."},
      {icon:"Icons/rom.jpg",name:"Rite magique",desc:"Accorde un nouveau sort de carte globale : permet au héros de convertir les points de mouvement en mana."}
    ],
    "13":[
      {icon:"Icons/at.jpg",name:"Enseignements des arcanes",desc:"+1 niveau à tous les sorts des arcanes."},
      {icon:"Icons/mf.jpg",name:"Flexibilité du mana",desc:"Utiliser des sorts coûte 2 de mana en moins."}
    ],
    "14":[
      {icon:"Icons/bma.jpg",name:"Pouvoir du mage guerrier",desc:"L'attaque des créatures alliées augmente de 20% de la puissance de sorts de leur héros (bonus x2 si le héros connaît : Sorcellerie."},
      {icon:"Icons/mpa.jpg",name:"Pouvoir du mage protecteur",desc:"La défense des créatures alliées augmente de 20% du savoir de leur héros (bonus x2 si le héros connaît : Résistance."}
    ],
    "15":[
      {icon:"Icons/pt1.jpg",name:"Enseignements primordiaux",desc:"Augmente de 1 le niveau de tous les sorts primordiaux."},
      {icon:"Icons/cr.jpg",name:"Règne du chaos",desc:"Le héros et les créatures alliées infligent 50% de dégâts supplémentaires avec les coups de chance (bonus x2 si le héros connaît : Sorts martiaux."}
    ],
    "16":[
      {icon:"Icons/pe.jpg",name:"Sorts perforants",desc:"Les sorts offensifs ignorent 15% de la résistance magique de la cible."},
      {icon:"Icons/hm.jpg",name:"Haut Mage",desc:"Tous vos sorts d'école de magie gagnent 1 niveau."}
    ],
    "17":[
      {icon:"Icons/rw.jpg",name:"Gardiens de la réalité",desc:"Les créatures alliées infligent +100% de dégâts aux créatures ennemies invoquées."},
      {icon:"Icons/tnil.jpg",name:"Leur nom est légion",desc:"Augmente de 50 % la quantité de créatures invoquées par les capacités des créatures alliées."}
    ],
    "18":[
      {icon:"Icons/pi.jpg",name:"Incantations pratiques",desc:"Coup Héroïque inflige +20 de dégâts."},
      {icon:"Icons/as.jpg",name:"Parchemins anciens",desc:"Ajoute tous les sorts de rang 1 à votre grimoire."}
    ],
    "19":[
      {icon:"Icons/aotd.jpg",name:"L'art de la négociation",desc:"Les pelotons sur la carte globale demandent 15% d'or en moins pour vous rejoindre (bonus x2 le héros connaît : Économie."},
      {icon:"Icons/va.jpg",name:"Armée vagabonde",desc:"Les créatures neutres ont un bonus de 100% de l'attaque et de la défense du héros lorsqu'elles sont dans son armée."}
    ],
    "20":[
      {icon:"Icons/lab.jpg",name:"Sauts et bonds",desc:"Le héros restaure 10 points de mouvement après chaque victoire au combat."},
      {icon:"Icons/btt.jpg",name:"Retour en ville !",desc:"Accorde un nouveau sort de carte globale. Il téléporte le héros dans la ville la plus proche qu'il contrôle. Tous les points de mouvement restants sont perdus."}
    ],
    "21":[
      {icon:"Icons/som.jpg",name:"Érudit de la magie",desc:"Permet aux héros de s'enseigner mutuellement des sorts. L'échange de connaissances se fait au contact. Seuls les sorts que l'autre partie est capable d'apprendre sont enseignés."},
      {icon:"Icons/ec.jpg",name:"Charisme infini",desc:"+1 en attaque, défense, puissance de sorts et savoir (bonus x2 si le héros connaît : Stratégie."}
    ],
    "22":[
      {icon:"Icons/e1.jpg",name:"Alchimiste",desc:"+5 de poussière alchimique par jour (bonus x2 si le héros connaît : Perspicacité."},
      {icon:"Icons/m1.jpg",name:"Marchand",desc:"Le héros compte comme un marché supplémentaire lors du calcul des prix de transaction."}
    ],
    "23":[
      {icon:"Icons/v.jpg",name:"Visions",desc:"Montre la composition exacte de toute armée ennemie dans un rayon de [300% x rayon de vision du héros] cases autour du héros."},
      {icon:"Icons/r.jpg",name:"Reconnaissance",desc:"Supprime le brouillard de guerre dans un rayon de [200% x rayon de vision du héros] autour du héros chaque matin."}
    ]
  },

};



/* ===== Build DATA from ICONS_CONFIG ===== */
function buildDataFromConfig(){
  const rings = ["outer","middle","inner"];
  const DATA = Array.from({length: rings.length}, (_, r) =>
    Array.from({length: SECTORS}, (_, s) =>
      Array.from({length: 3}, (_, j) => {
        const sectorKey = String(s+1).padStart(2,"0");
        const ringKey = rings[r];
        const cfgTriplet = ICONS_CONFIG[ringKey]?.[sectorKey]?.[j] || {};
        const icon = (cfgTriplet.icon && cfgTriplet.icon.trim()) ? cfgTriplet.icon.trim() : ICON_PLACEHOLDER;
        const name = (cfgTriplet.name && cfgTriplet.name.trim()) ? cfgTriplet.name.trim() : `${RINGS[r].name} ${sectorKey} ${["A","B","C"][j]}`;
        const desc = (cfgTriplet.desc && cfgTriplet.desc.trim()) ? cfgTriplet.desc.trim() : `Edit me: ${RINGS[r].name} ${sectorKey} ${["A","B","C"][j]}`;
        return { id:`r${r+1}s${sectorKey}-${["A","B","C"][j]}`, name, desc, icon };
      })
    )
  );
  return DATA;
}
const DATA = buildDataFromConfig();

/* ===== Core rendering code (unchanged logic) ===== */
const rad=d=>d*Math.PI/180, deg=r=>r*180/Math.PI;
const host=document.getElementById("wheelHost");
const svg=host.querySelector("svg");
const gRings=document.getElementById("rings");
const gSeps=document.getElementById("separators");
const gNodes=document.getElementById("nodes");
const gDebug=document.getElementById("debug");
const defs=document.getElementById("defs");
const tooltip=document.getElementById("tooltip");
const ttName=document.getElementById("ttName");
const ttDesc=document.getElementById("ttDesc");
const bgWatermark=document.getElementById("bgWatermark");
if (BACKGROUND_IMAGE) bgWatermark.style.backgroundImage=`url("${BACKGROUND_IMAGE}")`; else bgWatermark.remove();

const state=new Map();

/* Level chip (outer ring only) */
const LEVEL_MAX_DISPLAY=50, WARN_AT_SELECTED=21;
const levelChip=document.getElementById("levelChip");
const levelValue=document.getElementById("levelValue");
const levelNote=document.getElementById("levelNote");

/* Race panels DOM */
const raceSelect = document.getElementById("raceSelect");
const raceLeft   = document.getElementById("racePanelLeft");
const raceRight  = document.getElementById("racePanelRight");

/* Precompute OUTER IDs */
const OUTER_IDS=new Set();
for(let s=0;s<SECTORS;s++){ for(let j=0;j<3;j++){ OUTER_IDS.add(DATA[0][s][j].id); }}

/* Validation */
function validateConfig(){
  if(!Number.isFinite(SECTORS)||SECTORS<1) window.SECTORS=23;
  for(let i=0;i<RINGS.length;i++){
    const r=RINGS[i]; r.radius=Number(r.radius); r.sizeMax=Number(r.sizeMax);
    if(!Number.isFinite(r.radius)||r.radius<=0) r.radius=300;
    if(!Number.isFinite(r.sizeMax)||r.sizeMax<=0) r.sizeMax=32;
  }
  ["GROUP_GAP_DEG","INTRA_GAP_DEG","RADIAL_GAP_MIN","PAD_VISUAL"].forEach(k=>{
    window[k]=Number(window[k]);
    if(!Number.isFinite(window[k])){
      if(k==="GROUP_GAP_DEG") window[k]=1.6;
      if(k==="INTRA_GAP_DEG") window[k]=0.6;
      if(k==="RADIAL_GAP_MIN") window[k]=8;
      if(k==="PAD_VISUAL")     window[k]=4;
    }
  });
}
function drawRings(){
  gRings.innerHTML="";
  DECORATIVE_RINGS.forEach(dr=>{
    const c=document.createElementNS("http://www.w3.org/2000/svg","circle");
    c.setAttribute("class","ring"); c.setAttribute("cx","0"); c.setAttribute("cy","0"); c.setAttribute("r",String(dr.r));
    gRings.appendChild(c);
  });
}
function angularWidthDeg(imgRadius,R){
  const ext=imgRadius+PAD_VISUAL;
  if(!Number.isFinite(R)||R<=0) return 0;
  const ratio=Math.max(0,Math.min(1,ext/R));
  return deg(2*Math.asin(ratio));
}
function computeRingSizes(){
  const sizes=new Array(RINGS.length).fill(0);
  const sectorStep=360/SECTORS;
  const order=RINGS.map((r,i)=>[Number(r.radius),i]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]);
  const floor=6;
  for(let k=0;k<order.length;k++){
    const i=order[k], ring=RINGS[i], R=Number(ring.radius);
    let lo=floor, hi=Number(ring.sizeMax);
    if(k>0){
      const ii=order[k-1], innerR=Number(RINGS[ii].radius), innerSz=Number(sizes[ii])||0;
      const centerDist=R-innerR;
      const radialBound=centerDist - RADIAL_GAP_MIN - PAD_VISUAL - (innerSz+PAD_VISUAL);
      if(Number.isFinite(radialBound)) hi=Math.min(hi, radialBound);
    }
    if(!Number.isFinite(hi)||hi<lo) hi=lo;
    const fits=(s)=>{ if(!Number.isFinite(s)||s<=0) return false;
      const w=angularWidthDeg(s,R); if(w<=0) return false;
      return (3*w + 2*INTRA_GAP_DEG) <= (sectorStep - GROUP_GAP_DEG);
    };
    let l=lo,h=Math.max(lo,hi);
    for(let it=0;it<30;it++){ const mid=(l+h)/2; if(fits(mid)) l=mid; else h=mid; }
    sizes[i]=Number.isFinite(l)&&l>0?l:floor;
  }
  return sizes;
}
function drawSeparators(sizes){
  gSeps.innerHTML=""; if(!SEPARATORS.show) return;
  const sectorStep=360/SECTORS, dir=clockwise?-1:1;
  const innerVisualR=Math.min(...DECORATIVE_RINGS.map(d=>d.r));
  const outerVisualR=Math.max(...DECORATIVE_RINGS.map(d=>d.r));
  const innerBound=innerVisualR + RING_STROKE/2;
  const outerBound=outerVisualR - RING_STROKE/2;
  for(let s=0;s<SECTORS;s++){
    const ang=startAngle + dir*(s*sectorStep + sectorStep/2), a=rad(ang);
    const x1=Math.cos(a)*innerBound, y1=Math.sin(a)*innerBound;
    const x2=Math.cos(a)*outerBound, y2=Math.sin(a)*outerBound;
    const ln=document.createElementNS("http://www.w3.org/2000/svg","line");
    ln.setAttribute("class","sep");
    ln.setAttribute("x1",x1); ln.setAttribute("y1",y1);
    ln.setAttribute("x2",x2); ln.setAttribute("y2",y2);
    ln.setAttribute("stroke-width", SEPARATORS.strokeWidth);
    if(SEPARATORS.dashed) ln.setAttribute("stroke-dasharray","10 8");
    gSeps.appendChild(ln);
  }
}
function drawNodes(){
  gNodes.innerHTML=""; gDebug.innerHTML=""; defs.innerHTML="";
  const sizes=computeRingSizes(); drawSeparators(sizes);
  const sectorStep=360/SECTORS;
  RINGS.forEach((row,rowIdx)=>{
    let size=Number(sizes[rowIdx]); const R=Number(row.radius);
    if(!Number.isFinite(size)||size<=0){ size=12; } if(!Number.isFinite(R)||R<=0){ return; }
    const wDeg=angularWidthDeg(size,R); const spreadDeg=wDeg + INTRA_GAP_DEG; const ext=size+PAD_VISUAL;
    for(let s=0;s<SECTORS;s++){
      const sectorCenter=startAngle + (clockwise?-1:1)*(s*sectorStep);
      const offsets=[-spreadDeg, 0, +spreadDeg];
      offsets.forEach((off,j)=>{
        const angle=sectorCenter + off*(clockwise?1:-1);
        const x=Math.cos(rad(angle))*R, y=Math.sin(rad(angle))*R;
        const item=DATA[rowIdx]?.[s]?.[j]; const id=item.id;
        if(!state.has(id)) state.set(id,{selected:false});

        // clipPath centered on group origin
        const clipId=`clip-${id}`, cl=document.createElementNS("http://www.w3.org/2000/svg","clipPath");
        cl.setAttribute("id",clipId); cl.setAttribute("clipPathUnits","userSpaceOnUse");
        const clc=document.createElementNS("http://www.w3.org/2000/svg","circle");
        clc.setAttribute("r",String(size)); clc.setAttribute("cx","0"); clc.setAttribute("cy","0"); cl.appendChild(clc); defs.appendChild(cl);

        const g=document.createElementNS("http://www.w3.org/2000/svg","g");
        g.setAttribute("class","node"); g.setAttribute("transform",`translate(${x},${y})`);
        g.setAttribute("data-id",id); g.setAttribute("role","button");

        const hit=document.createElementNS("http://www.w3.org/2000/svg","circle");
        hit.setAttribute("class","hit"); hit.setAttribute("r",String(ext)); g.appendChild(hit);

        const badge=document.createElementNS("http://www.w3.org/2000/svg","circle");
        badge.setAttribute("class","badge"); badge.setAttribute("r",String(size+3.0)); g.appendChild(badge);

        const img=document.createElementNS("http://www.w3.org/2000/svg","image");
        img.setAttribute("x",String(-size)); img.setAttribute("y",String(-size));
        img.setAttribute("width",String(size*2)); img.setAttribute("height",String(size*2));
        img.setAttribute("preserveAspectRatio","xMidYMid slice"); img.setAttribute("clip-path",`url(#${clipId})`);
        img.setAttribute("class","icon"); img.setAttributeNS("http://www.w3.org/1999/xlink","href",item.icon||ICON_PLACEHOLDER); img.setAttribute("href",item.icon||ICON_PLACEHOLDER);
        g.appendChild(img);

        applyNodeClasses(g,id);

        g.addEventListener("pointerenter",()=>showTooltip(item));
        g.addEventListener("pointerleave",hideTooltip);
        g.addEventListener("pointermove",positionTooltip);
        g.addEventListener("click",ev=>{ ev.preventDefault(); toggleState(id,g); });

        gNodes.appendChild(g);
      });
    }
  });
}

/* Selection UI */
function toggleState(id,g){ const s=state.get(id); s.selected=!s.selected; applyNodeClasses(g,id); updateLevelUI(); }
function applyNodeClasses(g,id){ const s=state.get(id); g.classList.toggle("selected", !!s?.selected); }

/* Tooltip content & smart placement */
function showTooltip(item){
  ttName.textContent=item.name||"Skill";
  ttDesc.textContent=item.desc||"—";
  tooltip.classList.add("show");
  tooltip.setAttribute("aria-hidden","false");
}
function hideTooltip(){ tooltip.classList.remove("show"); tooltip.setAttribute("aria-hidden","true"); }
function positionTooltip(ev){
  const hostRect=host.getBoundingClientRect(), pad=8, gap=12;
  const mx=ev.clientX - hostRect.left, my=ev.clientY - hostRect.top;
  const ttRect=tooltip.getBoundingClientRect(); const tw=ttRect.width, th=ttRect.height;
  const minC=pad + tw/2, maxC=hostRect.width - pad - tw/2;
  const cx=Math.max(minC, Math.min(mx, maxC));
  let top=my - th - gap, pos="top";
  if(top < pad){ top=my + gap; pos="below"; if(top + th > hostRect.height - pad) top = hostRect.height - pad - th; }
  else { if(top < pad) top=pad; }
  tooltip.style.left=cx+"px"; tooltip.style.top=top+"px"; tooltip.setAttribute("data-pos",pos);
}

/* Level (outer only) */
function updateLevelUI(){
  let count=0; state.forEach((s,id)=>{ if(s?.selected && OUTER_IDS.has(id)) count++; });
  const shown=Math.min(count,50); levelValue.textContent=String(shown);
  const warn=count>21; levelChip.classList.toggle("warn",warn); levelNote.textContent=warn?"not enough skill slots":"";
}

/* ===== Race panels logic =====
   Reads from <template id="race-..."> and injects into the two panels.
   Edit the HTML inside those templates to change the content. */
function applyRace(raceName){
  const tpl = document.getElementById(`race-${raceName}`);
  const left = document.getElementById("racePanelLeft");
  const right= document.getElementById("racePanelRight");
  // Clear
  left.innerHTML = ""; right.innerHTML = "";
  if (!tpl) return;
  // Clone the template’s fragment so edits to panels don’t change the template
  const frag = tpl.content.cloneNode(true);
  const leftContent  = frag.querySelector(".left");
  const rightContent = frag.querySelector(".right");
  if (leftContent)  left.append(...Array.from(leftContent.childNodes));
  if (rightContent) right.append(...Array.from(rightContent.childNodes));
}

/* Init */
(function init(){
  const bg=document.getElementById("bgWatermark"); if(!BACKGROUND_IMAGE && bg) bg.remove();
  validateConfig();
  drawRings();
  drawNodes();
  updateLevelUI();

  // Race selector
  applyRace(raceSelect.value || "Temple");
  raceSelect.addEventListener("change", ()=>applyRace(raceSelect.value));

  new ResizeObserver(()=>{}).observe(host);
})();

 const subclassSelect = document.getElementById('subclassSelect');


  // Define subclasses per race
  const subclassOptions = {
	Temple: ['Bretteur', 'Parangon', 'Grand Inquisiteur', 'Ascendant'],
	Schism: ['Débridé', 'Insensible', 'Imparable', 'Insondable'],
	Necropolis: ['Héraut du destin', 'Pourriture ambulante', 'Tisse-âme', 'Chronomancien'],
	Dungeon: ["Garde du corps de Balthalzar", "Envoyé de Silvertongue", "Héritier d'Amelchia", 'Grand Marchand'],
    Hive: ['TBD', 'TBD', 'TBD'],
    Sylvan: ['TBD', 'TBD', 'TBD']
  };

  function updateSubclassOptions(race) {
    // Clear current options
    subclassSelect.innerHTML = '<option value="">— Sélectionner —</option>';

    if (subclassOptions[race]) {
      subclassOptions[race].forEach(sub => {
        const opt = document.createElement('option');
        opt.value = sub;
        opt.textContent = sub;
        subclassSelect.appendChild(opt);
      });
    }
  }

  // Update when race changes
  raceSelect.addEventListener('change', (e) => {
    updateSubclassOptions(e.target.value);
  });

  // Initialize (in case default race is pre-selected)
  updateSubclassOptions(raceSelect.value);
  
  /* ===== Subclass skill highlighting logic ===== */

// Map subclass names to arrays of outer skill IDs (e.g. outer10 = sector 10)
const subclassHighlights = {
Temple: {
  "Bretteur": ["outer12", "outer07", "outer01", "outer11", "outer2"],
  "Parangon": ["outer04", "outer10", "outer19", "outer17", "outer06"],
  "Grand Inquisiteur": ["outer13", "outer14", "outer03", "outer21", "outer23"],
  "Ascendant": ["outer22", "outer20", "outer15", "outer09", "outer16"]
},
Schism: {
  "Débridé": ["outer10", "outer07", "outer02", "outer23", "outer16"],
  "Insensible": ["outer19", "outer22", "outer12", "outer11", "outer09"],
  "Imparable": ["outer14", "outer04", "outer21", "outer15", "outer06"],
  "Insondable": ["outer13", "outer03", "outer20", "outer01", "outer17"]
},
Necropolis: {
  "Héraut du destin": ["outer03", "outer01", "outer15", "outer23", "outer16"],
  "Pourriture ambulante": ["outer19", "outer12", "outer11", "outer09", "outer06"],
  "Tisse-âme": ["outer13", "outer04", "outer21", "outer20", "outer17"],
  "Chronomancien": ["outer14", "outer10", "outer22", "outer02", "outer06"]
},
Dungeon: {
  "Garde du corps de Balthalzar": ["outer19", "outer12", "outer07", "outer11", "outer02"],
  "Envoyé de Silvertongue": ["outer10", "outer03", "outer01", "outer23", "outer16"],
  "Héritier d'Amelchia": ["outer04", "outer17", "outer06", "outer21", "outer15"],
  "Grand Marchand": ["outer13", "outer14", "outer22", "outer20", "outer09"]
},
 Hive: {
    TBD: ["outer03", "outer08", "outer12", "outer17", "outer22"],
    TBD: ["outer05", "outer06", "outer10", "outer14", "outer19"],
    TBD: ["outer01", "outer04", "outer09", "outer15", "outer21"]
		},
Sylvan: {
    TBD: ["outer02", "outer08", "outer11", "outer18", "outer20"],
    TBD:  ["outer04", "outer06", "outer10", "outer15", "outer23"],
    TBD:["outer03", "outer07", "outer09", "outer12", "outer16"]
  }
};

// Utility: clear any existing highlights
function clearHighlights() {
  document.querySelectorAll('.node.highlight-yellow').forEach(node => {
    node.classList.remove('highlight-yellow');
  });
}

// Utility: apply highlights for given race + subclass
function applyHighlights(race, subclass) {
  clearHighlights();
  const ids = subclassHighlights[race]?.[subclass] || [];
ids.forEach(id => {
  // Get sector number (e.g. "02", "12")
  let sectorNum = id.slice(5);
  if (sectorNum.length === 1) sectorNum = sectorNum.padStart(2, "0");

  // Match EXACT outer ring nodes (r1sXX-)
  const match = document.querySelectorAll(`.node[data-id^="r1s${sectorNum}-"]`);
  match.forEach(node => node.classList.add('highlight-yellow'));
});
}

// Hook into subclass dropdown
subclassSelect.addEventListener('change', e => {
  const subclass = e.target.value;
  const race = raceSelect.value;
  applyHighlights(race, subclass);
});

// Reapply when race changes (clears any previous highlights)
raceSelect.addEventListener('change', () => clearHighlights());
</script>
</body>
</html>
